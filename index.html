<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BlogCMS - Blog Management System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      .fade-in {
        animation: fadeIn 0.3s ease-in;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
    </style>
  </head>
  <body class="bg-gray-100 min-h-screen">
    <!-- Login Page -->
    <div
      id="loginPage"
      class="hidden min-h-screen flex items-center justify-center px-4"
    >
      <div class="bg-white p-8 rounded-lg shadow-lg max-w-md w-full">
        <h1 class="text-3xl font-bold text-center text-blue-600 mb-2">
          BlogCMS
        </h1>
        <p class="text-center text-gray-600 mb-6">Blog Management System</p>

        <div
          id="loginError"
          class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4"
        ></div>

        <form id="loginForm" class="space-y-4">
          <div>
            <label class="block text-gray-700 text-sm font-semibold mb-2"
              >Username</label
            >
            <input
              type="text"
              id="username"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
              required
            />
          </div>

          <div>
            <label class="block text-gray-700 text-sm font-semibold mb-2"
              >Password</label
            >
            <input
              type="password"
              id="password"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
              required
            />
          </div>

          <button
            type="submit"
            class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition duration-200 font-semibold"
          >
            Login
          </button>
        </form>

        <button
          id="backToArticlesBtn"
          class="w-full mt-4 bg-gray-500 text-white py-2 rounded-lg hover:bg-gray-600 transition duration-200"
        >
          Back to Articles
        </button>

        <div class="mt-6 p-4 bg-gray-50 rounded-lg">
          <p class="text-sm text-gray-600 font-semibold mb-2">Demo Accounts:</p>
          <p class="text-xs text-gray-600">Admin: admin / admin123</p>
          <p class="text-xs text-gray-600">Author: author1 / author123</p>
        </div>
      </div>
    </div>

    <!-- Main Blog Page -->
    <div id="blogPage">
      <!-- Navigation Bar -->
      <nav class="bg-white shadow-md">
        <div
          class="container mx-auto px-4 py-4 flex justify-between items-center"
        >
          <h1
            class="text-2xl font-bold text-blue-600 cursor-pointer"
            onclick="showArticlesPage()"
          >
            BlogCMS
          </h1>
          <div class="flex items-center gap-4">
            <div id="guestButtons" class="flex gap-3">
              <button
                id="loginNavBtn"
                class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition duration-200"
              >
                Login
              </button>
            </div>
            <div id="userButtons" class="hidden flex items-center gap-4">
              <span class="text-gray-700"
                >Welcome,
                <span id="currentUserName" class="font-semibold"></span
              ></span>
              <span
                id="userRole"
                class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-semibold"
              ></span>
              <button
                id="logoutBtn"
                class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition duration-200"
              >
                Logout
              </button>
            </div>
          </div>
        </div>
      </nav>

      <!-- Main Content -->
      <div class="container mx-auto px-4 py-8">
        <!-- Create Article Button (Admin & Author Only) -->
        <div id="createArticleSection" class="mb-6 hidden">
          <button
            id="showCreateFormBtn"
            class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition duration-200 font-semibold"
          >
            + Create New Article
          </button>
        </div>

        <!-- Create Article Form -->
        <div
          id="createArticleForm"
          class="hidden bg-white p-6 rounded-lg shadow-lg mb-8 fade-in"
        >
          <h2 class="text-2xl font-bold mb-4 text-gray-800">
            Create New Article
          </h2>
          <form id="articleForm" class="space-y-4">
            <div>
              <label class="block text-gray-700 text-sm font-semibold mb-2"
                >Title</label
              >
              <input
                type="text"
                id="articleTitle"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                required
              />
            </div>

            <div>
              <label class="block text-gray-700 text-sm font-semibold mb-2"
                >Category</label
              >
              <select
                id="articleCategory"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                required
              >
                <option value="">Select a category</option>
              </select>
            </div>

            <div>
              <label class="block text-gray-700 text-sm font-semibold mb-2"
                >Content</label
              >
              <textarea
                id="articleContent"
                rows="8"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                required
              ></textarea>
            </div>

            <div class="flex gap-3">
              <button
                type="submit"
                class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition duration-200 font-semibold"
              >
                Publish Article
              </button>
              <button
                type="button"
                id="cancelCreateBtn"
                class="bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition duration-200"
              >
                Cancel
              </button>
            </div>
          </form>
        </div>

        <!-- Category Filter -->
        <div class="mb-6 bg-white p-4 rounded-lg shadow-md">
          <label class="block text-gray-700 text-sm font-semibold mb-2"
            >Filter by Category:</label
          >
          <select
            id="categoryFilter"
            class="w-full md:w-64 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
          >
            <option value="">All Categories</option>
          </select>
        </div>

        <!-- Articles List -->
        <div id="articlesList" class="space-y-6"></div>

        <!-- No Articles Message -->
        <div
          id="noArticles"
          class="text-center py-12 bg-white rounded-lg shadow-md hidden"
        >
          <p class="text-gray-500 text-lg">
            No articles found in this category.
          </p>
        </div>
      </div>
    </div>

    <!-- Article Detail Modal -->
    <div
      id="articleModal"
      class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center px-4 z-50"
    >
      <div
        class="bg-white rounded-lg shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto"
      >
        <div class="p-6">
          <div class="flex justify-between items-start mb-4">
            <div>
              <h2
                id="modalTitle"
                class="text-3xl font-bold text-gray-800 mb-2"
              ></h2>
              <span
                id="modalCategory"
                class="inline-block px-3 py-1 bg-purple-100 text-purple-800 rounded-full text-sm font-semibold"
              ></span>
            </div>
            <button
              id="closeModalBtn"
              class="text-gray-500 hover:text-gray-700 text-2xl"
            >
              &times;
            </button>
          </div>

          <div class="mb-4 flex items-center gap-4 text-sm text-gray-600">
            <span>By <span id="modalAuthor" class="font-semibold"></span></span>
            <span id="modalDate"></span>
          </div>

          <div
            id="modalContent"
            class="text-gray-700 mb-8 leading-relaxed whitespace-pre-line"
          ></div>

          <!-- Comments Section -->
          <div class="border-t pt-6">
            <h3 class="text-xl font-bold mb-4 text-gray-800">Comments</h3>

            <!-- Add Comment Form (For Everyone) -->
            <div id="commentFormSection" class="mb-6 bg-gray-50 p-4 rounded-lg">
              <input
                type="text"
                id="commentName"
                placeholder="Your name"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 mb-2"
                required
              />
              <textarea
                id="commentInput"
                rows="3"
                placeholder="Write your comment..."
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 mb-2"
                required
              ></textarea>
              <button
                id="submitCommentBtn"
                class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition duration-200"
              >
                Post Comment
              </button>
            </div>

            <!-- Comments List -->
            <div id="commentsList" class="space-y-4"></div>

            <!-- No Comments Message -->
            <div id="noComments" class="text-center py-6 text-gray-500 hidden">
              No comments yet. Be the first to comment!
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Data Arrays (Ready for PHP/Database migration)
      let users = [
        {
          id: 1,
          username: "admin",
          password: "admin123",
          role: "admin",
          banned: false,
        },
        {
          id: 2,
          username: "author1",
          password: "author123",
          role: "author",
          banned: false,
        },
      ];

      let categories = [
        { id: 1, name: "Technology" },
        { id: 2, name: "Lifestyle" },
        { id: 3, name: "Business" },
        { id: 4, name: "Health" },
        { id: 5, name: "Education" },
      ];

      let articles = [
        {
          id: 1,
          title: "Welcome to BlogCMS",
          content:
            "This is a demo article showcasing the BlogCMS system. Admins and authors can create articles, while users can read and comment on them. The admin has full control over the platform.",
          categoryId: 1,
          categoryName: "Technology",
          authorId: 1,
          authorName: "admin",
          date: new Date().toISOString(),
        },
        {
          id: 2,
          title: "Getting Started with Blogging",
          content:
            "Blogging is a great way to share your thoughts and ideas with the world. In this article, we will explore the basics of blogging and how you can get started with your own blog.",
          categoryId: 5,
          categoryName: "Education",
          authorId: 2,
          authorName: "author1",
          date: new Date(Date.now() - 86400000).toISOString(),
        },
      ];

      let comments = [
        {
          id: 1,
          articleId: 1,
          userName: "John Doe",
          content: "Great article! Looking forward to more content.",
          date: new Date().toISOString(),
        },
      ];

      let currentUser = null;
      let currentArticleId = null;
      let selectedCategoryFilter = "";

      // DOM Elements
      const loginPage = document.getElementById("loginPage");
      const blogPage = document.getElementById("blogPage");
      const loginForm = document.getElementById("loginForm");
      const loginError = document.getElementById("loginError");
      const loginNavBtn = document.getElementById("loginNavBtn");
      const backToArticlesBtn = document.getElementById("backToArticlesBtn");
      const logoutBtn = document.getElementById("logoutBtn");
      const guestButtons = document.getElementById("guestButtons");
      const userButtons = document.getElementById("userButtons");
      const currentUserName = document.getElementById("currentUserName");
      const userRole = document.getElementById("userRole");
      const createArticleSection = document.getElementById(
        "createArticleSection"
      );
      const showCreateFormBtn = document.getElementById("showCreateFormBtn");
      const createArticleForm = document.getElementById("createArticleForm");
      const articleForm = document.getElementById("articleForm");
      const cancelCreateBtn = document.getElementById("cancelCreateBtn");
      const articlesList = document.getElementById("articlesList");
      const noArticles = document.getElementById("noArticles");
      const articleModal = document.getElementById("articleModal");
      const closeModalBtn = document.getElementById("closeModalBtn");
      const submitCommentBtn = document.getElementById("submitCommentBtn");
      const commentFormSection = document.getElementById("commentFormSection");
      const loginToCommentMessage = document.getElementById(
        "loginToCommentMessage"
      );
      const categoryFilter = document.getElementById("categoryFilter");
      const articleCategory = document.getElementById("articleCategory");

      // Initialize
      function init() {
        loadCategories();
        loadArticles();
      }

      // Load Categories into dropdowns
      function loadCategories() {
        // Load into create form
        articleCategory.innerHTML =
          '<option value="">Select a category</option>';
        categories.forEach((cat) => {
          const option = document.createElement("option");
          option.value = cat.id;
          option.textContent = cat.name;
          articleCategory.appendChild(option);
        });

        // Load into filter
        categoryFilter.innerHTML = '<option value="">All Categories</option>';
        categories.forEach((cat) => {
          const option = document.createElement("option");
          option.value = cat.id;
          option.textContent = cat.name;
          categoryFilter.appendChild(option);
        });
      }

      // Category Filter Handler
      categoryFilter.addEventListener("change", (e) => {
        selectedCategoryFilter = e.target.value;
        loadArticles();
      });

      // Show Login Page
      function showLoginPage() {
        loginPage.classList.remove("hidden");
        blogPage.classList.add("hidden");
        articleModal.classList.add("hidden");
      }

      // Show Articles Page
      function showArticlesPage() {
        loginPage.classList.add("hidden");
        blogPage.classList.remove("hidden");
        createArticleForm.classList.add("hidden");
      }

      // Login Nav Button
      loginNavBtn.addEventListener("click", showLoginPage);

      // Back to Articles Button
      backToArticlesBtn.addEventListener("click", showArticlesPage);

      // Login Handler
      loginForm.addEventListener("submit", (e) => {
        e.preventDefault();
        const username = document.getElementById("username").value;
        const password = document.getElementById("password").value;

        const user = users.find(
          (u) => u.username === username && u.password === password
        );

        if (!user) {
          showError("Invalid username or password");
          return;
        }

        if (user.banned) {
          showError("Your account has been banned");
          return;
        }

        currentUser = user;
        showArticlesPage();

        guestButtons.classList.add("hidden");
        userButtons.classList.remove("hidden");
        currentUserName.textContent = user.username;
        userRole.textContent = user.role.toUpperCase();

        if (user.role === "admin" || user.role === "author") {
          createArticleSection.classList.remove("hidden");
        }

        loginForm.reset();
        loadArticles();
      });

      function showError(message) {
        loginError.textContent = message;
        loginError.classList.remove("hidden");
        setTimeout(() => loginError.classList.add("hidden"), 3000);
      }

      // Logout Handler
      logoutBtn.addEventListener("click", () => {
        currentUser = null;
        guestButtons.classList.remove("hidden");
        userButtons.classList.add("hidden");
        createArticleSection.classList.add("hidden");
        createArticleForm.classList.add("hidden");
        loadArticles();
      });

      // Show Create Article Form
      showCreateFormBtn.addEventListener("click", () => {
        createArticleForm.classList.remove("hidden");
        window.scrollTo({ top: 0, behavior: "smooth" });
      });

      // Cancel Create Article
      cancelCreateBtn.addEventListener("click", () => {
        createArticleForm.classList.add("hidden");
        articleForm.reset();
      });

      // Create Article Handler
      articleForm.addEventListener("submit", (e) => {
        e.preventDefault();
        const title = document.getElementById("articleTitle").value;
        const content = document.getElementById("articleContent").value;
        const categoryId = parseInt(
          document.getElementById("articleCategory").value
        );
        const category = categories.find((c) => c.id === categoryId);

        const newArticle = {
          id:
            articles.length > 0
              ? Math.max(...articles.map((a) => a.id)) + 1
              : 1,
          title,
          content,
          categoryId,
          categoryName: category.name,
          authorId: currentUser.id,
          authorName: currentUser.username,
          date: new Date().toISOString(),
        };

        articles.push(newArticle);
        createArticleForm.classList.add("hidden");
        articleForm.reset();
        loadArticles();
      });

      // Load Articles
      function loadArticles() {
        articlesList.innerHTML = "";

        let filteredArticles = articles;
        if (selectedCategoryFilter) {
          filteredArticles = articles.filter(
            (a) => a.categoryId == selectedCategoryFilter
          );
        }

        if (filteredArticles.length === 0) {
          noArticles.classList.remove("hidden");
          return;
        }

        noArticles.classList.add("hidden");

        filteredArticles.forEach((article) => {
          const articleCard = document.createElement("div");
          articleCard.className =
            "bg-white p-6 rounded-lg shadow-md hover:shadow-lg transition duration-200";

          const commentsCount = comments.filter(
            (c) => c.articleId === article.id
          ).length;

          articleCard.innerHTML = `
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <h3 class="text-xl font-bold text-gray-800 mb-2">${escapeHtml(
                              article.title
                            )}</h3>
                            <span class="inline-block px-3 py-1 bg-purple-100 text-purple-800 rounded-full text-xs font-semibold">
                                ${escapeHtml(article.categoryName)}
                            </span>
                        </div>
                        ${
                          currentUser && currentUser.role === "admin"
                            ? `
                            <button onclick="deleteArticle(${article.id})" class="text-red-600 hover:text-red-800 font-semibold">
                                Delete
                            </button>
                        `
                            : ""
                        }
                    </div>
                    <p class="text-gray-600 mb-4 line-clamp-3">${escapeHtml(
                      article.content.substring(0, 150)
                    )}${article.content.length > 150 ? "..." : ""}</p>
                    <div class="flex justify-between items-center text-sm text-gray-500">
                        <span>By <span class="font-semibold">${escapeHtml(
                          article.authorName
                        )}</span> • ${formatDate(article.date)}</span>
                        <span>${commentsCount} comment${
            commentsCount !== 1 ? "s" : ""
          }</span>
                    </div>
                    <button onclick="viewArticle(${
                      article.id
                    })" class="mt-4 text-blue-600 hover:text-blue-800 font-semibold">
                        Read More →
                    </button>
                `;

          articlesList.appendChild(articleCard);
        });
      }

      // Delete Article (Admin Only)
      function deleteArticle(articleId) {
        if (confirm("Are you sure you want to delete this article?")) {
          articles = articles.filter((a) => a.id !== articleId);
          comments = comments.filter((c) => c.articleId !== articleId);
          loadArticles();
        }
      }

      // View Article in Modal
      function viewArticle(articleId) {
        currentArticleId = articleId;
        const article = articles.find((a) => a.id === articleId);

        document.getElementById("modalTitle").textContent = article.title;
        document.getElementById("modalCategory").textContent =
          article.categoryName;
        document.getElementById("modalAuthor").textContent = article.authorName;
        document.getElementById("modalDate").textContent = formatDate(
          article.date
        );
        document.getElementById("modalContent").textContent = article.content;

        loadComments(articleId);
        articleModal.classList.remove("hidden");
      }

      // Close Modal
      closeModalBtn.addEventListener("click", () => {
        articleModal.classList.add("hidden");
        currentArticleId = null;
      });

      // Load Comments
      function loadComments(articleId) {
        const commentsList = document.getElementById("commentsList");
        const noComments = document.getElementById("noComments");
        const articleComments = comments.filter(
          (c) => c.articleId === articleId
        );

        commentsList.innerHTML = "";

        if (articleComments.length === 0) {
          noComments.classList.remove("hidden");
          return;
        }

        noComments.classList.add("hidden");

        articleComments.forEach((comment) => {
          const commentDiv = document.createElement("div");
          commentDiv.className = "bg-gray-50 p-4 rounded-lg";

          commentDiv.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <span class="font-semibold text-gray-800">${escapeHtml(
                          comment.userName
                        )}</span>
                        <span class="text-xs text-gray-500">${formatDate(
                          comment.date
                        )}</span>
                    </div>
                    <p class="text-gray-700">${escapeHtml(comment.content)}</p>
                `;

          commentsList.appendChild(commentDiv);
        });
      }

      // Submit Comment
      submitCommentBtn.addEventListener("click", () => {
        const commentInput = document.getElementById("commentInput");
        const commentName = document.getElementById("commentName");
        const content = commentInput.value.trim();
        const name = commentName.value.trim();

        if (!content || !name) {
          alert("Please enter your name and comment");
          return;
        }

        const newComment = {
          id:
            comments.length > 0
              ? Math.max(...comments.map((c) => c.id)) + 1
              : 1,
          articleId: currentArticleId,
          userName: name,
          content,
          date: new Date().toISOString(),
        };

        comments.push(newComment);
        commentInput.value = "";
        commentName.value = "";
        loadComments(currentArticleId);
        loadArticles();
      });

      // Utility Functions
      function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString("en-US", {
          year: "numeric",
          month: "short",
          day: "numeric",
        });
      }

      function escapeHtml(text) {
        const div = document.createElement("div");
        div.textContent = text;
        return div.innerHTML;
      }

      // Make functions global for onclick handlers
      window.deleteArticle = deleteArticle;
      window.viewArticle = viewArticle;
      window.showLoginPage = showLoginPage;
      window.showArticlesPage = showArticlesPage;

      // Initialize on load
      init();
    </script>
  </body>
</html>
